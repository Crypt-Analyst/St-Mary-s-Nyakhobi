{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }} - St. Mary's Nyakhobi School{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/gallery.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css">
{% endblock %}

{% block content %}
<div class="container-fluid py-5" style="background: linear-gradient(135deg, var(--primary-color) 0%, #a0002a 100%); margin-top: -20px;">
    <div class="container">
        <div class="text-center text-white">
            <h1 class="display-4 fw-bold mb-3">ðŸ“¸ Photo Gallery</h1>
            <p class="lead mb-0">Capturing precious moments and achievements at St. Mary's Nyakhobi School</p>
        </div>
    </div>
</div>

<div class="container py-5">
    <!-- Gallery Statistics -->
    <div class="row mb-5">
        <div class="col-md-4 text-center">
            <div class="stat-card">
                <i class="fas fa-images text-maroon mb-3" style="font-size: 3rem;"></i>
                <h3 class="fw-bold text-maroon">{{ stats.total_albums }}</h3>
                <p class="text-muted">Photo Albums</p>
            </div>
        </div>
        <div class="col-md-4 text-center">
            <div class="stat-card">
                <i class="fas fa-camera text-maroon mb-3" style="font-size: 3rem;"></i>
                <h3 class="fw-bold text-maroon">{{ stats.total_photos }}</h3>
                <p class="text-muted">Total Photos</p>
            </div>
        </div>
        <div class="col-md-4 text-center">
            <div class="stat-card">
                <i class="fas fa-folder text-maroon mb-3" style="font-size: 3rem;"></i>
                <h3 class="fw-bold text-maroon">{{ stats.categories_count }}</h3>
                <p class="text-muted">Categories</p>
            </div>
        </div>
    </div>

    <!-- Gallery Categories -->
    <div class="row mb-5">
        <div class="col-12">
            <h2 class="text-center mb-4 text-maroon fw-bold">Browse by Category</h2>
            <div class="row">
                {% for category in categories %}
                <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                    <a href="{% url 'gallery:category_albums' category.slug %}" class="text-decoration-none">
                        <div class="category-card h-100">
                            <div class="card-body text-center">
                                <i class="{{ category.icon }} category-icon mb-3"></i>
                                <h5 class="card-title fw-bold">{{ category.name }}</h5>
                                <p class="card-text text-muted">{{ category.albums.count }} album{{ category.albums.count|pluralize }}</p>
                                {% if category.description %}
                                <p class="card-text small">{{ category.description|truncatewords:10 }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Featured Albums -->
    {% if featured_albums %}
    <div class="row mb-5">
        <div class="col-12">
            <h2 class="text-center mb-4 text-maroon fw-bold">âœ¨ Featured Albums</h2>
            <div class="row">
                {% for album in featured_albums %}
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="album-card h-100">
                        <div class="album-cover">
                            {% if album.cover_photo %}
                            <img src="{{ album.cover_photo.url }}" alt="{{ album.title }}" class="img-fluid">
                            {% else %}
                            <div class="no-image d-flex align-items-center justify-content-center">
                                <i class="fas fa-images fa-3x text-muted"></i>
                            </div>
                            {% endif %}
                            <div class="album-overlay">
                                <div class="album-info">
                                    <h5 class="album-title">{{ album.title }}</h5>
                                    <p class="album-stats">
                                        <i class="fas fa-camera me-1"></i> {{ album.photo_count }} photo{{ album.photo_count|pluralize }}
                                        {% if album.event_date %}
                                        <br><i class="fas fa-calendar me-1"></i> {{ album.event_date|date:"M d, Y" }}
                                        {% endif %}
                                    </p>
                                    <a href="{{ album.get_absolute_url }}" class="btn btn-light btn-sm">
                                        <i class="fas fa-eye me-1"></i> View Album
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="card-title fw-bold mb-1">{{ album.title }}</h6>
                                    <small class="text-muted">{{ album.category.name }}</small>
                                </div>
                                <span class="badge bg-maroon">Featured</span>
                            </div>
                            <p class="card-text mt-2">{{ album.description|truncatewords:15 }}</p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Recent Albums -->
    {% if recent_albums %}
    <div class="row mb-5">
        <div class="col-12">
            <h2 class="text-center mb-4 text-maroon fw-bold">ðŸ•’ Recent Albums</h2>
            <div class="row">
                {% for album in recent_albums %}
                <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                    <div class="album-card-small h-100">
                        <div class="album-cover-small">
                            {% if album.cover_photo %}
                            <img src="{{ album.cover_photo.url }}" alt="{{ album.title }}" class="img-fluid">
                            {% else %}
                            <div class="no-image d-flex align-items-center justify-content-center">
                                <i class="fas fa-images fa-2x text-muted"></i>
                            </div>
                            {% endif %}
                            <div class="album-overlay-small">
                                <a href="{{ album.get_absolute_url }}" class="btn btn-light btn-sm">
                                    <i class="fas fa-eye"></i>
                                </a>
                            </div>
                        </div>
                        <div class="card-body p-3">
                            <h6 class="card-title fw-bold mb-1">{{ album.title|truncatewords:3 }}</h6>
                            <small class="text-muted d-block mb-2">{{ album.category.name }}</small>
                            <p class="card-text small mb-2">
                                <i class="fas fa-camera me-1"></i> {{ album.photo_count }}
                                <i class="fas fa-eye ms-2 me-1"></i> {{ album.views_count }}
                            </p>
                            {% if album.event_date %}
                            <small class="text-muted">{{ album.event_date|date:"M d, Y" }}</small>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Call to Action -->
    <div class="row">
        <div class="col-12 text-center">
            <div class="cta-section p-5 rounded" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                <h3 class="text-maroon fw-bold mb-3">Explore All Our Memories</h3>
                <p class="lead text-muted mb-4">Discover more photos from school events, academics, sports, and community activities</p>
                <div class="d-flex justify-content-center gap-3 flex-wrap">
                    {% for category in categories|slice:":4" %}
                    <a href="{% url 'gallery:category_albums' category.slug %}" class="btn btn-outline-maroon">
                        <i class="{{ category.icon }} me-1"></i> {{ category.name }}
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Search Modal -->
<div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="searchModalLabel">Search Gallery</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="get" action="{% url 'gallery:search_gallery' %}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="searchQuery" class="form-label">Search for photos or albums</label>
                        <input type="text" class="form-control" id="searchQuery" name="q" 
                               placeholder="Enter keywords..." required>
                    </div>
                    <p class="text-muted small">
                        <i class="fas fa-info-circle me-1"></i>
                        You can search by album titles, photo captions, or event names.
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-maroon">
                        <i class="fas fa-search me-1"></i> Search
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add search button to navbar if not exists
    const navbar = document.querySelector('.navbar-nav');
    if (navbar && !document.querySelector('.gallery-search-btn')) {
        const searchLi = document.createElement('li');
        searchLi.className = 'nav-item';
        searchLi.innerHTML = `
            <button class="nav-link btn btn-link gallery-search-btn" 
                    data-bs-toggle="modal" data-bs-target="#searchModal">
                <i class="fas fa-search"></i> Search Gallery
            </button>
        `;
        navbar.appendChild(searchLi);
    }

    // Lightbox configuration
    lightbox.option({
        'resizeDuration': 200,
        'wrapAround': true,
        'albumLabel': "Image %1 of %2"
    });
});
</script>
{% endblock %}